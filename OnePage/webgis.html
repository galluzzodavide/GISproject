<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>AirAware - WebGIS</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/AA.png" rel="icon">
  <link href="assets/img/AirAware.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.5.0/ol.css">
  <!-- OpenLayers CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.5.0/ol.css">
  <!-- LayerSwitcher CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.1/dist/ol-layerswitcher.css" />
  <!-- OpenLayers JS -->
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.5.0/dist/ol.js"></script>
  <!-- LayerSwitcher JS -->
  <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.1"></script>

  <style>
    #map {
      width: 100%;
      height: 600px;
      position: relative;
      overflow: hidden;
    }

    .ol-control.ol-full-screen button {
      width: 28px;
      height: 28px;
      font-size: 16px;
      border-radius: 2px;
      background: #fff;
      color: #333;
      box-shadow: 0 1px 4px rgba(0, 60, 136, .2);
      padding: 0;
      line-height: 1;
      display: inline-block;
      transition: background 0.2s;
      border: none;
    }

    .ol-control.ol-full-screen button:hover {
      background: #e6e6e6;
    }

    .ol-control.ol-recenter {
      background: none;
      box-shadow: none;
      padding: 0;
    }

    .ol-control.ol-recenter button {
      background: #fff;
      color: #333;
      border: none;
      border-radius: 2px;
      width: 28px;
      /* Match OpenLayers fullscreen button */
      height: 28px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0, 60, 136, .2);
      padding: 0;
      line-height: 1;
      /* Remove flex properties */
      display: inline-block;
      align-items: unset;
      justify-content: unset;
      transition: background 0.2s;
    }

    .ol-control.ol-recenter button:hover {
      background: #e6e6e6;
    }

    .ol-mouse-position.custom-mouse-coords {
      box-sizing: content-box;
      white-space: nowrap;
      width: auto !important;
      max-width: 220px !important;
      height: auto !important;
      padding: 6px 12px !important;
      overflow: visible !important;
      text-overflow: clip !important;
      display: inline-block;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      line-height: 1.4;
      pointer-events: none;
      position: relative;
      z-index: 1100;
    }

    #mouse-coords-container {
      position: absolute;
      bottom: 3em;
      right: 1em;
      max-width: none !important;
      width: auto !important;
      pointer-events: none;
      z-index: 10;
    }

    #map-controls {
      position: absolute;
      top: 0.5em;
      right: 0.5em;
      display: flex;
      gap: 0.5em;
      z-index: 10;
      pointer-events: none;
    }

    #map-controls .ol-control {
      pointer-events: auto;
      margin: 0;
      position: static;
    }

    #map-legend {
      position: absolute;
      top: 4em;
      left: 1em;
      background: white;
      border: 1px solid #ccc;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.15);
      font-size: 14px;
      z-index: 10;
      width: fit-content;
      max-width: 200px;
    }

    #map-legend h5 {
      margin: 0 0 10px;
      font-size: 16px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 4px;
    }
  </style>


</head>

<body class="webgis-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center">

      <a href="home.html" class="logo d-flex align-items-center me-auto">
        <!-- <img src="assets/img/logo.png" alt=""> -->
        <h1 class="sitename">AirAware</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="workflow.html">Workflow</a></li>
          <li><a href="results.html">Results</a></li>
          <li><a href="webgis.html" class="active">WebGIS</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

      <!-- No extra header button on WebGIS page -->
    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="bg-image"></div>
      <div class="content">
        <h1>WebGIS</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">WebGIS</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- WebGIS Section -->
    <section id="webgis" class="service-details section">
      <div class="container">
        <p>Explore air quality data with the interactive map. Pan and zoom the map to navigate, and click on
          markers or regions for more information. The map displays air quality measurements (such as pollutant
          concentrations or AQI) with color-coded markers and layers to indicate pollution levels.</p>
      </div>
      <div id="map">
        <div id="map-controls"></div>
        <div id="mouse-coords-container"></div>
        <div id="map-legend">
          <h5>Map Legend</h5>

          <!-- Hungary Outline Layer -->
          <div class="legend-item">
            <label>
              <input type="checkbox" id="toggle-country-layer" checked>
              <span style="border-left: 12px solid red; padding-left: 6px;">Hungary Outline</span>
            </label>
            <div style="margin-top: 5px;">
              <label for="opacity-country">Opacity:</label>
              <input type="range" id="opacity-country" min="0" max="1" step="0.05" value="0.4">
              <span id="opacity-country-value">40%</span>
            </div>
          </div>

          <!-- No2 Concentration Layer -->
          <div class="legend-item" style="margin-top: 15px;">
            <label>
              <input type="checkbox" id="toggle-no2-layer" checked>
              <span style="border-left: 12px solid #0066cc; padding-left: 6px;">NO<sub>2</sub> Concentration</span>
            </label>
            <div style="margin-top: 5px;">
              <label for="opacity-no2">Opacity:</label>
              <input type="range" id="opacity-no2" min="0" max="1" step="0.05" value="1.0">
              <span id="opacity-no2-value">100%</span>
            </div>

          </div>
        </div>
    </section>
    <!-- /WebGIS Section -->
  </main>

  <footer id="footer" class="footer light-background">

    <div class="container footer-top">

      <div class="row gy-3">

        <div class="col-lg-2 col-md-12 footer-about">
          <div style="width:150px; height:150px; overflow:hidden;">
            <img src="assets/img/AirAware.png" alt="" style="width:100%; height:100%; object-fit: contain;">
          </div>
        </div>

        <div class="col-lg-4 col-md-12 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">AirAware</span>
          </a>
          <p><strong>Air matters. Data speaks. Maps reveal.</strong><br>
            A collaborative GIS project on air pollution in Hungary by three students from the MSc Geoinformatics
            Engineering program at Politecnico di Milano.</p>
        </div>

        <div class="col-lg-2 col-6 footer-links">
          <h4>Pollutants</h4>
          <ul>
            <li><a href="index.html#pollutants-info">Overview</a></li>
            <li><a href="results.html#pm2p5-title">PM<sub>2.5</sub></a></li>
            <li><a href="results.html#pm10-title">PM<sub>10</sub></a></li>
            <li><a href="results.html#no2-title">NO<sub>2</sub></a></li>
          </ul>
        </div>

        <div class="col-lg-4 col-md-12 footer-contact text-center text-md-start">
          <h4>Contact Us</h4>
          <div class="contact-person">
            <strong>Davide Galluzzo</strong> -
            <a href="mailto:davide.galluzzo@mail.polimi.it">davide.galluzzo@mail.polimi.it</a>
            <a href="https://github.com/galluzzodavide" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>

          <div class="contact-person">
            <strong>Giada Nespoli</strong> -
            <a href="mailto:giada.nespoli@mail.polimi.it">giada.nespoli@mail.polimi.it</a>
            <a href="https://github.com/giadanespoli" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>

          <div class="contact-person">
            <strong>Luciana Bertucci</strong> -
            <a href="mailto:luciana.bertucci@mail.polimi.it">luciana.bertucci@mail.polimi.it</a>
            <a href="https://github.com/lucibertucci" target="_blank" rel="noopener noreferrer" class="ms-2">
              <i class="bi bi-github"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>©️ <span>Copyright</span> <strong class="px-1 sitename">AirAware</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.5.0/dist/ol.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ol-layerswitcher@4.1.1"></script>
  <script src="assets/js/map.js"></script>
  <script>

    // Add scale line, full screen, and mouse position controls
    class RecenterControl extends ol.control.Control {
      constructor(opt_options) {
        const options = opt_options || {};
        const button = document.createElement('button');
        button.innerHTML = '<i class="bi bi-crosshair"></i>';
        button.title = 'Recenter map';

        const element = document.createElement('div');
        element.className = 'ol-control ol-recenter ol-unselectable';
        element.appendChild(button);

        super({
          element: element,
          target: 'map-controls'
        });

        button.addEventListener('click', () => {
          map.getView().setCenter(ol.proj.fromLonLat(initialCoordinates));
          map.getView().setZoom(initialZoom);
        }, false);
      }
    }
const initialCoordinates = [19.5033, 47.1625];
const initialZoom = 7;

const wmsUrl = "https://www.gis-geoserver.polimi.it/geoserver/gisgeoserver_12/wms";

// Define the 5 WMS layers
const no2Concentration = new ol.layer.Tile({
  title: "no2Concentration",
  visible: true,
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { "LAYERS":"gisgeoserver_12:Hungary_no2_concentration_map_2020", 
    "STYLES": "Hungary_no2_concentration_map_2020",
    "TILED":true
   },
    serverType: "geoserver"
  })
});
const landCover2022 = new ol.layer.Tile({
  title: "HUNGARY_LC_reclassified_2022",
  visible: false,
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { "LAYERS":"gisgeoserver_12:HUNGARY_LC_reclassified_2022", 
    "STYLES": "HUNGARY_LC_reclassified_2022",  
    "TILED":true
    },
    
    serverType: "geoserver"
  })
});
const no2AAD2022 = new ol.layer.Tile({
  title: "HungaryAADmap2022",
  visible: false,
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { "LAYERS":"gisgeoserver_12:HungaryAADmap2022", 
    "STYLES":"Hungary_no2_2017-2021_AAD_map_2022",
    "TILED":true 
  },
    serverType: "geoserver"
  })
});
const no2Bivariate2020 = new ol.layer.Tile({
  title: "hungaryno22020bivariate",
  visible: false,
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { "LAYERS":"gisgeoserver_12:hungaryno22020bivariate	", 
    "STYLES": "Hungary_no2_2020_bivariate",  
    "TILED":true },
    serverType: "geoserver"
  })
});
const no2ZonalStats = new ol.layer.Tile({
  title: "hungaryno2zonalstatistics20132022",
  visible: false,
  source: new ol.source.TileWMS({
    url: wmsUrl,
    params: { "LAYERS":"gisgeoserver_12:hungaryno2zonalstatistics20132022	", "TILED":true },
    serverType: "geoserver"
  })
});

const concentration_map_2020 = new ol.layer.Group({
  title: "Concentration maps 2020",
  fold: "close",
  layers: [
    no2Concentration,
  ]
});

const annualaveragedifference = new ol.layer.Group({
  title: "2022 Annual Average Difference",
  fold: "close",
  layers: [
    no2AAD2022,
  ]
});

const zonal_statistics_20132022 = new ol.layer.Group({
  title: "Zonal Statistics 2013-2022",
  fold: "close",
  layers: [
    no2ZonalStats,
  ]
});

const bivariate2020 = new ol.layer.Group({
  title: "2020 bivariate",
  fold: "close",
  layers: [
    no2Bivariate2020,
  ]
});

// CREA LA MAPPA CON OSM + IL GRUPPO
const baseMaps = new ol.layer.Group({
  title: "Base maps",
  fold: "open",
  type: "overlay",
  layers: [
    new ol.layer.Tile({
      title: "OpenStreetMap",
      type: "base",
      visible: true,
      source: new ol.source.OSM()
    })
  ]
});

const map = new ol.Map({
  target: "map",
  layers: [baseMaps, concentration_map_2020, annualaveragedifference, zonal_statistics_20132022, bivariate2020], // aggiungili subito qui!
  view: new ol.View({
    center: ol.proj.fromLonLat([19.0, 47.0]),
    zoom: initialZoom
  })
});


// Add LayerSwitcher on top right
const layerSwitcher = new LayerSwitcher({
  activationMode: "click",
  startActive: true,
  groupSelectStyle: "group"
});
map.addControl(layerSwitcher);

// Add other controls
map.addControl(new RecenterControl({ target: 'map-controls' }));
map.addControl(new ol.control.FullScreen({ target: 'map-controls' }));
map.addControl(new ol.control.ScaleLine());
map.addControl(new ol.control.MousePosition({
  coordinateFormat: ol.coordinate.createStringXY(4),
  projection: 'EPSG:4326',
  className: 'ol-mouse-position custom-mouse-coords',
  placeholder: '0.0000, 0.0000',
  target: document.getElementById('mouse-coords-container')
}));

// Add Hungary GeoJSON country layer with opacity + toggle
let countryLayer;
fetch('assets/data/hungary.geojson')
.then(res => res.json())
.then(geojson => {
  countryLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
      features: new ol.format.GeoJSON().readFeatures(geojson, {
        featureProjection: 'EPSG:3857'
      })
    }),
    style: new ol.style.Style({
      stroke: new ol.style.Stroke({ color: 'red', width: 2 }),
      fill: new ol.style.Fill({ color: 'rgba(255, 0, 0, 0.4)' })
    })
  });
  map.addLayer(countryLayer);

  // Country layer toggle + opacity slider
  document.getElementById('toggle-country-layer').addEventListener('change', function() {
    countryLayer.setVisible(this.checked);
  });
  document.getElementById('opacity-country').addEventListener('input', function() {
    countryLayer.setOpacity(parseFloat(this.value));
    document.getElementById('opacity-country-value').textContent = Math.round(this.value * 100) + '%';
  });
});

// Custom NO2 slider and toggle
document.getElementById('toggle-no2-layer').addEventListener('change', function() {
  no2Concentration.setVisible(this.checked);
});
document.getElementById('opacity-no2').addEventListener('input', function() {
  no2Concentration.setOpacity(parseFloat(this.value));
  document.getElementById('opacity-no2-value').textContent = Math.round(this.value * 100) + '%';
});
  </script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>